<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="itwillbs.p2c3.boogimovie.mapper.AdminMapper">
	
	<select id="selectMemberList" resultType="hashmap">
		SELECT * 
		FROM member
	</select>

	<select id="selectMember" resultType="itwillbs.p2c3.boogimovie.vo.MemberVO">
		SELECT * 
		FROM member
		WHERE member_id = #{id}
	</select>
	
	<delete id="deleteMember">
		DELETE FROM member
		WHERE member_id = #{id}
	</delete>
	
	<select id="selectMovieList" resultType="hashmap">
		SELECT * 
		FROM movie
	</select>

	<select id="selectMovie" resultType="itwillbs.p2c3.boogimovie.vo.MovieVO">
		SELECT * 
		FROM movie
		WHERE movie_num = #{movie_num}
	</select>
	
	<update id="updateMovie">
		<selectKey keyProperty="board_num" resultType="int" order="BEFORE">
			SELECT board_num  
			FROM board -- update를 위한 동일한 board_num 조회
		</selectKey>
		
		UPDATE movie
		SET movie_name = #{movie_name},
			movie_director = #{movie_director},
			movie_poster = #{movie_poster},
			stillcut_num = #{stillcut_num},
			movie_trailler = #{movie_trailler},
			movie_open_date = #{movie_open_date},
			movie_status = #{movie_status},
			genre_name = #{genre_name},
			movie_grade = #{movie_grade},
			movie_summary = #{movie_summary}
		WHERE movie_num = #{movie_num}
	</update>
	
	<!-- 여기서부터 csc 관련 sql=========================================== -->
	<insert id="insertNotice" >
		<selectKey keyProperty="notice_num" resultType="int" order="BEFORE">
			SELECT IFNULL(MAX(notice_num), 0) FROM notice
		</selectKey>
		
	INSERT INTO notice (notice_num, notice_subject, notice_content, theater_num, notice_date )
	VALUES (#{notice_num} + 1, #{notice.notice_subject}, #{notice.notice_content}, #{theater_num}, now())
		
	</insert>
	
	<select id="selectNoticeList" resultType="itwillbs.p2c3.boogimovie.vo.NoticeVO">
		SELECT n.notice_num
			  ,n.notice_subject
			  ,n.notice_content
			  ,t.theater_name
			  ,n.notice_date
		FROM notice n JOIN theater t 
		ON n.theater_num = t.theater_num
		ORDER BY notice_num DESC
		LIMIT #{startRow}, #{listLimit}
	</select>
	<insert id="insertReply">
		<selectKey keyProperty="oto_reply_num" resultType="int" order="BEFORE">
			SELECT IFNULL(MAX(oto_reply_num), 0) FROM OTO_reply
		</selectKey>
		INSERT INTO OTO_reply
		VALUES (#{oto_reply_num} + 1,
				#{oto_num}, 
				#{reply.oto_reply_content},
				now())
	</insert>
	<delete id="deleteNotice">
		DELETE FROM notice
		WHERE notice_num = #{notice_num}
	</delete>
	<select id="getNoticeListCount" resultType="int">
		SELECT COUNT(notice_num) FROM notice
	</select>
	
</mapper>
